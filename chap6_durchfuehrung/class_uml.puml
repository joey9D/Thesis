@startuml
title GPIO / SPI (STM32-Pfad â€“ abstrahiert)

interface IGpio {
  +gpio_init(...)
  +read()
  +write(bool)
  +toggle()
}

class GpioStm32 {
  -port : GPIO_TypeDef*
  -pinMask : uint16_t
  -invert : bool
  +gpio_init(cfg)
  +read()
  +write(bool)
  +toggle()
}

interface ISpi {
  +spi_init(cfg)
  +transfer(tx, rx, len)
}

interface IDma {
  +dma_init()
  +startTx(...)
  +startRx(...)
  +isBusy()
}

class DmaStm32 {
  -channelTx
  -channelRx
  +dma_init()
  +startTx(...)
  +startRx(...)
  +isBusy()
}

class SpiStm32 {
  -handle : SPI_HandleTypeDef
  -clkEnabled : bool
  -cs : IGpio*
  -dma : DmaStm32*
  +spi_init(cfg)
  +transfer(...)
  +transferDma(...)
}

IGpio <|.. GpioStm32
ISpi <|.. SpiStm32
IDma <|.. DmaStm32
SpiStm32 --> IGpio : nutzt CS
SpiStm32 --> DmaStm32 : optional
GpioStm32 ..> Stm32HalWrapper
SpiStm32 ..> Stm32HalWrapper
DmaStm32 ..> Stm32HalWrapper
@enduml
